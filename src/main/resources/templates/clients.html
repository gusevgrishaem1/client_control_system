<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Table</title>
    <!-- Подключение стилей Tabulator -->
    <link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator.min.css" rel="stylesheet">
    <!-- Подключение основного файла Tabulator -->
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
    <style>
        /* Общие стили для страницы */
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        /* Контейнер для таблицы и формы */
        #controls {
            margin: 20px auto;
            max-width: 1000px;
            text-align: center;
        }

        #client-table {
            margin: 20px auto;
            max-width: 1000px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            background-color: #fff;
        }

        /* Стили для формы добавления и редактирования */
        #client-form {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        #client-form input {
            width: calc(25% - 10px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #client-form button {
            padding: 10px 20px;
            border: none;
            background-color: #28a745;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        #client-form button:hover {
            background-color: #218838;
        }

        /* Кнопки подтверждения и отмены */
        #save-button, #cancel-button {
            display: none;
            margin-top: 10px;
            padding: 10px 20px;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        #save-button {
            background-color: #007bff;
        }

        #save-button:hover {
            background-color: #0056b3;
        }

        #cancel-button {
            background-color: #dc3545;
        }

        #cancel-button:hover {
            background-color: #c82333;
        }

        #action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .tabulator-edit-button, .tabulator-delete-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .tabulator-edit-button:hover, .tabulator-delete-button:hover {
            background-color: #0056b3;
        }

        .tabulator-delete-button {
            background-color: #dc3545;
        }

        .tabulator-delete-button:hover {
            background-color: #c82333;
        }

        .tabulator-edit-button {
            margin-right: 5px;
        }
    </style>
</head>
<body>

<!-- Заголовок страницы -->
<h1>Список Клиентов</h1>

<!-- Форма добавления и редактирования клиента -->
<div id="controls">
    <form id="client-form">
        <input type="text" id="inn" placeholder="ИНН" required>
        <input type="text" id="title" placeholder="Название" required>
        <input type="text" id="telephone" placeholder="Телефон" required>
        <button type="submit">Добавить</button>
    </form>
    <div id="action-buttons">
        <button id="save-button">Подтвердить</button>
        <button id="cancel-button">Отмена</button>
    </div>
</div>

<!-- Контейнер для таблицы -->
<div id="client-table"></div>

<script>
    function generateRandomClientData(num) {
        const clients = [];
        const generateRandomPhone = () => `+7 999 ${Math.floor(Math.random() * 1000)}-${Math.floor(Math.random() * 100)}-${Math.floor(Math.random() * 100)}`;
        const generateRandomINN = () => `${Math.floor(Math.random() * 10000000000)}`;
        const generateRandomTitle = () => `Компания ${Math.floor(Math.random() * 10000)}`;

        for (let i = 0; i < num; i++) {
            clients.push({
                id: i + 1,
                inn: generateRandomINN(),
                title: generateRandomTitle(),
                telephone: generateRandomPhone(),
            });
        }
        return clients;
    }

    var clientData = generateRandomClientData(100); // Генерация 100 записей

    var originalData = {}; // Объект для хранения оригинальных данных
    var editedRowId = null; // ID редактируемой строки

    // Инициализация таблицы
    var table = new Tabulator("#client-table", {
        data: clientData,
        layout: "fitColumns",
        columns: [
            {title: "ID", field: "id", hozAlign: "center", width: 70, headerFilter: "input"},
            {title: "ИНН", field: "inn", hozAlign: "center", editor: "input", width: 150, headerFilter: "input"},
            {title: "Название", field: "title", editor: "input", width: 350, headerFilter: "input"},
            {title: "Телефон", field: "telephone", hozAlign: "center", editor: "input", width: 150, headerFilter: "input"},
            {
                title: "Действия",
                formatter: function(cell, formatterParams, onRendered) {
                    return `<button class="tabulator-edit-button">Редактировать</button>
                            <button class="tabulator-delete-button">Удалить</button>`;
                },
                width: 300,
                hozAlign: "center",
                cellClick: function(e, cell) {
                    var button = e.target;
                    if (button.classList.contains("tabulator-edit-button")) {
                        // Обработка кнопки редактирования
                        startEditing(cell.getRow());
                    } else if (button.classList.contains("tabulator-delete-button")) {
                        // Обработка кнопки удаления
                        if (confirm("Вы уверены, что хотите удалить эту запись?")) {
                            cell.getRow().delete();
                        }
                    }
                }
            },
        ],
        addRowPos: "top",
    });

    // Функция для начала редактирования строки
    function startEditing(row) {
        var rowData = row.getData();
        document.getElementById("inn").value = rowData.inn;
        document.getElementById("title").value = rowData.title;
        document.getElementById("telephone").value = rowData.telephone;
        editedRowId = rowData.id;
        originalData = {...rowData};
        document.getElementById("save-button").style.display = "inline-block";
        document.getElementById("cancel-button").style.display = "inline-block";
    }

    // Функция подтверждения изменений
    document.getElementById("save-button").addEventListener("click", function () {
        if (editedRowId !== null) {
            var rowData = {
                id: editedRowId,
                inn: document.getElementById("inn").value,
                title: document.getElementById("title").value,
                telephone: document.getElementById("telephone").value,
            };
            table.updateData([rowData]); // Обновляем данные в таблице
            hideActionButtons(); // Скрываем кнопки "Подтвердить" и "Отмена"
            editedRowId = null;
            document.getElementById("inn").value = '';
            document.getElementById("title").value = '';
            document.getElementById("telephone").value = '';
        }
    });

    // Функция отмены изменений
    document.getElementById("cancel-button").addEventListener("click", function () {
        if (editedRowId !== null) {
            table.updateData([originalData]); // Возвращаем оригинальные данные
            hideActionButtons(); // Скрываем кнопки "Подтвердить" и "Отмена"
            editedRowId = null;
            document.getElementById("inn").value = '';
            document.getElementById("title").value = '';
            document.getElementById("telephone").value = '';
        }
    });

    // Функция скрытия кнопок "Подтвердить" и "Отмена"
    function hideActionButtons() {
        document.getElementById("save-button").style.display = "none";
        document.getElementById("cancel-button").style.display = "none";
    }

    // Функция добавления нового клиента
    document.getElementById("client-form").addEventListener("submit", function (e) {
        e.preventDefault();

        var inn = document.getElementById("inn").value;
        var title = document.getElementById("title").value;
        var telephone = document.getElementById("telephone").value;

        if (editedRowId === null) {
            // Добавление нового клиента
            table.addRow({
                id: clientData.length + 1,
                inn: inn,
                title: title,
                telephone: telephone
            });
        } else {
            // Обновление существующего клиента
            var rowData = {
                id: editedRowId,
                inn: inn,
                title: title,
                telephone: telephone,
            };
            table.updateData([rowData]);
            editedRowId = null; // Сброс ID редактируемой строки
        }

        // Очистка формы
        document.getElementById("inn").value = '';
        document.getElementById("title").value = '';
        document.getElementById("telephone").value = '';
        hideActionButtons(); // Скрываем кнопки "Подтвердить" и "Отмена"
    });
</script>

</body>
</html>
